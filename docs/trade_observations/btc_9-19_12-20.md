New order placed correctly
Price went down
    What went right:
        - 1st SL triggered!
        - a fourth of the position as expected!
        - a SL buy order was placed at current_unit + 1 as expected. 
    What went wrong:
        - the buy order was cancelled even though it was correct. 

on the brightside I observed the price go up and a trailing stop at the bottom was moved up. but without the buy order it doesn't really matter. 

One thing to Note here is that if the position size is initially 10000, then when our first sell is executed, 
then our position size goes down by roughly 1/4 so it should be around 7500. and we would have 2500 sitting in 
cash waiting for the buy order to be triggered. So on this trade a fragment in usd is 2500. 

Ultimately the goal is to be in position at the lowest price possible.

if we sold 1 of the SL's then we should still have 3 sell SL's and we should have 1 buy SL's each roughly 2500. So we have 4 orders placed.
So we would have buy orders at current_unit +1 
and We would have sells at current_unit -1, -2 and -3
We would be roughly 7500 in position and 2500 in cash 

if we sold 2 of the sl then we should still have 2 sell SL's and we should have 2 buy SL's each roughly 2500. So we have 4 orders placed.
So we would have buy orders at current_unit +1 and +2
and We would have sells at current_unit -1 and -2
We would be roughly 5000 in position and 5000 in cash 

if we sold 3 of the SL's then we should still have 1 sell SL and we should have 3 buy SL's each roughly 2500. So we have 4 orders placed.
So we would have buy orders at current_unit +1, +2 and +3
and We would have sells at current_unit -1 
We would be roughly 2500 in position and 7500 in cash 

if we sold 4 of the SL's then we should still have 0 sell SL and we should have 4 buy SL's each roughly 2500. So we have 4 orders placed.
So we would have buy orders at current_unit +1, +2, +3 and +4
and We would have 0 sells
We would be roughly 0 in position and 10000 in cash

As the price goes down we add a buy at current +1 and then cancel the buy at current +5 maintaining orders at current_unit +1, +2, +3 and +4

if the price goes up and we buy 1 of the SL's then we should still have 3 buy SL's and 1 sell SL's each roughly 2500. So we have 4 orders placed.
So we would have buy orders at current_unit +1, +2 and +3
and We would have sells at current_unit -1 
We would be roughly 2500 in position and 7500 in cash 

if the price goes up and we buy 2 of the SL's then we should still have 2 buy SL's and 2 sell SL's each roughly 2500. So we have 4 orders placed.
So we would have buy orders at current_unit +1 and +2
and We would have sells at current_unit -1 and -2
We would be roughly 5000 in position and 5000 in cash 

if the price goes up and we buy 3 of the SL's then we should still have 1 buy SL's and 3 sell SL's each roughly 2500. So we have 4 orders placed.
So we would have buy orders at current_unit +1 
and We would have sells at current_unit -1, -2 and -3
We would be roughly 7500 in position and 2500 in cash 

if the price goes up and we buy 4 of the SL's then we should have 0 buy SL's and 4 sell SL's each roughly 2500. So we have 4 orders placed.
So we would have 0 buy orders 
and We would have sells at current_unit -1, -2, -3 and -4
We would be roughly 10000 in position and 0 in cash 

As the price goes up we add a sell at current -1 and then cancel the sell at current -5 maintaining orders at current_unit -1, -2, -3 and -4


# Trade Log
(.venv) PS C:\Users\trini\Desktop\software_engineer\2025\crypto\HyperTrader\backend> uv run python src/main.py --symbol BTC --wallet long --unit-size 25 --position-size 20000 --leverage 40 --testnet
warning: `VIRTUAL_ENV=C:\Users\trini\Desktop\software_engineer\2025\crypto\HyperTrader\.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead
2025-09-19 12:21:03.963 | INFO     | __main__:__init__:71 - Initializing HyperTrader for BTC - long wallet
2025-09-19 12:21:06.043 | INFO     | exchange.hyperliquid_sdk:_initialize_clients:108 - Initialized with main wallet 0x329C49...
2025-09-19 12:21:06.043 | INFO     | __main__:initialize:85 - SDK client initialized for long wallet
2025-09-19 12:21:06.044 | INFO     | core.websocket_client:connect:31 - Connecting to Hyperliquid WebSocket: wss://api.hyperliquid-testnet.xyz/ws
2025-09-19 12:21:06.351 | INFO     | core.websocket_client:connect:35 - Successfully connected to Hyperliquid WebSocket
2025-09-19 12:21:06.351 | INFO     | __main__:initialize:98 - WebSocket client connected
2025-09-19 12:21:06.352 | INFO     | core.websocket_client:subscribe_to_user_fills:79 - Subscribed to user fills for address: 0x329C49392608175A071fC9AF982fF625f119fFAE
2025-09-19 12:21:06.353 | INFO     | __main__:initialize:102 - Subscribed to order fills for address: 0x329C49392608175A071fC9AF982fF625f119fFAE
2025-09-19 12:21:06.596 | INFO     | __main__:initialize:106 - Current BTC price: $115457.50
2025-09-19 12:21:06.596 | WARNING  | __main__:_initialize_position:131 - üöÄ ENTERING _initialize_position
2025-09-19 12:21:06.596 | INFO     | __main__:_initialize_position:134 - üìä Checking for existing positions...
2025-09-19 12:21:06.721 | INFO     | __main__:_initialize_position:136 -    Found positions for symbols: []
2025-09-19 12:21:06.721 | WARNING  | __main__:_initialize_position:146 - ‚ùå NO EXISTING POSITION for BTC - Creating new one
2025-09-19 12:21:06.721 | WARNING  | __main__:_initialize_position:151 - üìà CREATING NEW POSITION:
2025-09-19 12:21:06.722 | WARNING  | __main__:_initialize_position:152 -    Symbol: BTC
2025-09-19 12:21:06.722 | WARNING  | __main__:_initialize_position:153 -    Wallet type: long
2025-09-19 12:21:06.722 | WARNING  | __main__:_initialize_position:154 -    Current price: $115457.50
2025-09-19 12:21:06.722 | WARNING  | __main__:_initialize_position:155 -    Position size USD: $20000.0
2025-09-19 12:21:06.722 | WARNING  | __main__:_initialize_position:156 -    Estimated asset size: 0.173224 BTC
2025-09-19 12:21:06.723 | WARNING  | __main__:_initialize_position:157 -    Leverage: 40x
2025-09-19 12:21:06.723 | WARNING  | __main__:_initialize_position:161 - üî• PLACING INITIAL MARKET BUY ORDER...
2025-09-19 12:21:06.723 | WARNING  | __main__:_place_market_order:450 - üéØ _place_market_order called:
2025-09-19 12:21:06.724 | WARNING  | __main__:_place_market_order:451 -    Side: buy
2025-09-19 12:21:06.724 | WARNING  | __main__:_place_market_order:452 -    Size: 0.1732239135612671329277006691 BTC
2025-09-19 12:21:06.852 | WARNING  | __main__:_place_market_order:458 -    Current price: $115457.50
2025-09-19 12:21:06.852 | WARNING  | __main__:_place_market_order:459 -    USD amount: $20000.00
2025-09-19 12:21:06.852 | WARNING  | __main__:_place_market_order:460 -    Leverage: 40x
2025-09-19 12:21:06.852 | WARNING  | __main__:_place_market_order:461 -    Is buy: True
2025-09-19 12:21:06.853 | WARNING  | __main__:_place_market_order:463 - üìû Calling SDK open_position...
2025-09-19 12:21:06.853 | INFO     | exchange.hyperliquid_sdk:set_leverage:271 - Setting leverage to 40x for BTC
2025-09-19 12:21:07.545 | INFO     | exchange.hyperliquid_sdk:set_leverage:281 - ‚úÖ Successfully set leverage to 40x for BTC
2025-09-19 12:21:08.039 | INFO     | exchange.hyperliquid_sdk:open_position:348 - Opening LONG position: 0.17322 BTC ($20000.00000000000000000000000)
2025-09-19 12:21:09.590 | WARNING  | __main__:_place_market_order:472 - üìã SDK open_position result:
2025-09-19 12:21:09.590 | WARNING  | __main__:_place_market_order:473 -    Success: True
2025-09-19 12:21:09.591 | WARNING  | __main__:_place_market_order:474 -    Order ID: 39342159993
2025-09-19 12:21:09.591 | WARNING  | __main__:_initialize_position:164 - üìù Market order result:
2025-09-19 12:21:09.591 | WARNING  | __main__:_initialize_position:165 -    Success: True
2025-09-19 12:21:09.592 | WARNING  | __main__:_initialize_position:166 -    Order ID: 39342159993
2025-09-19 12:21:09.592 | WARNING  | __main__:_initialize_position:167 -    Error: None
2025-09-19 12:21:09.592 | WARNING  | __main__:_initialize_position:175 - ‚úÖ Initial position order placed! ID: 39342159993
2025-09-19 12:21:09.592 | INFO     | __main__:_initialize_position:178 - ‚è≥ Waiting for initial position to be fully established...
2025-09-19 12:21:11.720 | INFO     | __main__:_initialize_position:186 -    Attempt 1: Positions found: ['BTC']
2025-09-19 12:21:11.720 | WARNING  | __main__:_initialize_position:189 - ‚úÖ POSITION FOUND after 2 seconds
2025-09-19 12:21:11.720 | WARNING  | __main__:_initialize_position:199 - ‚úÖ POSITION ESTABLISHED: 0.086620 BTC @ $115480.00 (actual fill price)
2025-09-19 12:21:11.720 | INFO     | strategy.position_map:calculate_initial_position_map:65 - Position map created: Entry $115480.0, Unit size $25.0
2025-09-19 12:21:11.721 | INFO     | strategy.position_map:calculate_initial_position_map:66 - Fragments: 0.021655 asset, $2500.72 USD
2025-09-19 12:21:11.721 | INFO     | strategy.position_map:calculate_initial_position_map:68 - Range: $114980.00 to $115980.00
2025-09-19 12:21:11.721 | INFO     | __main__:_initialize_position:215 - üìè Unit spacing: $25.00 = 0.022% of entry price $115480.00
2025-09-19 12:21:11.721 | ERROR    | __main__:_initialize_position:218 - ‚ö†Ô∏è WARNING: Unit size too small! 0.022% spacing will cause order clustering
2025-09-19 12:21:11.722 | ERROR    | __main__:_initialize_position:219 - ‚ö†Ô∏è Recommended minimum unit size for BTC at $115480.00: $577.40 (0.5% spacing)
2025-09-19 12:21:11.722 | INFO     | __main__:_initialize_position:223 - üìä Unit price verification:
2025-09-19 12:21:11.722 | INFO     | __main__:_initialize_position:227 -    Unit  -4: $115380.0000
2025-09-19 12:21:11.722 | INFO     | __main__:_initialize_position:227 -    Unit  -3: $115405.0000
2025-09-19 12:21:11.723 | INFO     | __main__:_initialize_position:227 -    Unit  -2: $115430.0000
2025-09-19 12:21:11.723 | INFO     | __main__:_initialize_position:227 -    Unit  -1: $115455.0000
2025-09-19 12:21:11.723 | INFO     | __main__:_initialize_position:227 -    Unit   0: $115480.0000
2025-09-19 12:21:11.723 | INFO     | __main__:_initialize_position:227 -    Unit   1: $115505.0000
2025-09-19 12:21:11.723 | INFO     | __main__:_initialize_position:227 -    Unit   2: $115530.0000
2025-09-19 12:21:11.723 | INFO     | __main__:_initialize_position:227 -    Unit   3: $115555.0000
2025-09-19 12:21:11.723 | INFO     | __main__:_initialize_position:227 -    Unit   4: $115580.0000
2025-09-19 12:21:11.724 | INFO     | strategy.unit_tracker:__init__:43 - UnitTracker initialized with stop-losses at [-4, -3, -2, -1]
2025-09-19 12:21:11.724 | WARNING  | __main__:_place_window_orders:252 - üìã INITIAL WINDOW STATE:
2025-09-19 12:21:11.724 | WARNING  | __main__:_place_window_orders:253 -    trailing_stop: [-4, -3, -2, -1]
2025-09-19 12:21:11.724 | WARNING  | __main__:_place_window_orders:254 -    trailing_buy: []
2025-09-19 12:21:11.725 | INFO     | exchange.hyperliquid_sdk:place_stop_order:498 - Placing SELL stop order: 0.021655 BTC triggers @ $115380.00
2025-09-19 12:21:13.075 | INFO     | __main__:_place_stop_loss_order:425 - Placed STOP LOSS at unit -4: 0.021655 BTC triggers @ $115380.00
2025-09-19 12:21:13.075 | WARNING  | __main__:_place_stop_loss_order:426 - üìù ORDER ID TRACKING: Stop-loss at unit -4 = 39342161264
2025-09-19 12:21:13.075 | INFO     | exchange.hyperliquid_sdk:place_stop_order:498 - Placing SELL stop order: 0.021655 BTC triggers @ $115405.00
2025-09-19 12:21:14.713 | INFO     | __main__:_place_stop_loss_order:425 - Placed STOP LOSS at unit -3: 0.021655 BTC triggers @ $115405.00
2025-09-19 12:21:14.713 | WARNING  | __main__:_place_stop_loss_order:426 - üìù ORDER ID TRACKING: Stop-loss at unit -3 = 39342161760
2025-09-19 12:21:14.714 | INFO     | exchange.hyperliquid_sdk:place_stop_order:498 - Placing SELL stop order: 0.021655 BTC triggers @ $115430.00
2025-09-19 12:21:16.220 | INFO     | __main__:_place_stop_loss_order:425 - Placed STOP LOSS at unit -2: 0.021655 BTC triggers @ $115430.00
2025-09-19 12:21:16.220 | WARNING  | __main__:_place_stop_loss_order:426 - üìù ORDER ID TRACKING: Stop-loss at unit -2 = 39342163015
2025-09-19 12:21:16.221 | INFO     | exchange.hyperliquid_sdk:place_stop_order:498 - Placing SELL stop order: 0.021655 BTC triggers @ $115455.00
2025-09-19 12:21:17.735 | INFO     | __main__:_place_stop_loss_order:425 - Placed STOP LOSS at unit -1: 0.021655 BTC triggers @ $115455.00
2025-09-19 12:21:17.735 | WARNING  | __main__:_place_stop_loss_order:426 - üìù ORDER ID TRACKING: Stop-loss at unit -1 = 39342163585
2025-09-19 12:21:17.735 | WARNING  | __main__:_place_window_orders:264 - ‚úÖ INITIAL SETUP COMPLETE - Placed 4 stop-loss orders
2025-09-19 12:21:17.736 | WARNING  | __main__:_place_window_orders:265 - üìã Active position_map units: [-4, -3, -2, -1]
2025-09-19 12:21:17.736 | INFO     | __main__:_initialize_position:238 - Position initialized with sliding window: {'current_unit': 0, 'phase': 'advance', 'trailing_stop': [-4, -3, -2, -1], 'trailing_buy': [], 'total_orders': 4, 'current_realized_pnl': 0.0}
2025-09-19 12:21:17.736 | WARNING  | __main__:_initialize_position:241 - üîß Running initial window validation and repair...
2025-09-19 12:21:17.986 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: 0, Phase: advance, Has Position: True
2025-09-19 12:21:17.987 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2, -1]
2025-09-19 12:21:17.987 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: []
2025-09-19 12:21:17.987 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 4 stops, 0 buys
2025-09-19 12:21:17.987 | WARNING  | __main__:_initialize_position:243 - ‚úÖ Initial window setup complete - Stops: [-4, -3, -2, -1], Buys: []
2025-09-19 12:21:17.988 | INFO     | core.websocket_client:subscribe_to_trades:109 - Subscribed to BTC trades
2025-09-19 12:21:17.988 | INFO     | __main__:initialize:118 - ‚úÖ HyperTrader initialization complete
2025-09-19 12:21:17.988 | INFO     | __main__:run:959 - Starting HyperTrader main loop
2025-09-19 12:21:17.989 | INFO     | core.websocket_client:listen:121 - Starting WebSocket listener with Hyperliquid heartbeat...
2025-09-19 12:21:17.990 | WARNING  | core.websocket_client:_handle_user_fills:400 - ORDER FILL: BTC BUY 0.08662 @ $115480.00 (Order ID: 39342159993)
2025-09-19 12:21:17.990 | INFO     | core.websocket_client:_handle_user_fills:407 - Triggering fill callback for BTC
2025-09-19 12:21:17.990 | WARNING  | core.websocket_client:_handle_user_fills:408 - üìù FILL CALLBACK: Passing order_id=39342159993 (type: <class 'int'>)
2025-09-19 12:21:17.990 | WARNING  | __main__:handle_order_fill:832 - üîî FILL RECEIVED - Order ID: 39342159993, Price: $115480.00, Size: 0.08662
2025-09-19 12:21:17.991 | INFO     | __main__:handle_order_fill:836 - Ignoring initial position order fill (ID: 39342159993)
2025-09-19 12:21:18.111 | INFO     | core.websocket_client:_handle_trades:330 - BTC price feed started: $115480.00
2025-09-19 12:21:27.992 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:21:28.624 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: 0, Phase: advance, Has Position: True
2025-09-19 12:21:28.624 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2, -1]
2025-09-19 12:21:28.625 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: []
2025-09-19 12:21:28.625 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 4 stops, 0 buys
2025-09-19 12:21:31.604 | WARNING  | core.websocket_client:_handle_user_fills:400 - ORDER FILL: BTC BUY 0.02166 @ $115455.00 (Order ID: 39342163585)
2025-09-19 12:21:31.604 | INFO     | core.websocket_client:_handle_user_fills:407 - Triggering fill callback for BTC
2025-09-19 12:21:31.605 | WARNING  | core.websocket_client:_handle_user_fills:408 - üìù FILL CALLBACK: Passing order_id=39342163585 (type: <class 'int'>)
2025-09-19 12:21:31.605 | WARNING  | __main__:handle_order_fill:832 - üîî FILL RECEIVED - Order ID: 39342163585, Price: $115455.00, Size: 0.02166
2025-09-19 12:21:31.605 | INFO     | __main__:handle_order_fill:856 - ‚úÖ Fast lookup: Order 39342163585 maps to unit -1
2025-09-19 12:21:31.605 | INFO     | __main__:handle_order_fill:867 - Order filled at unit -1: stop_sell 0.021660 @ $115455.00
2025-09-19 12:21:31.606 | INFO     | strategy.unit_tracker:track_realized_pnl:234 - Realized PnL: $-0.54 (Total: $-0.54)
2025-09-19 12:21:31.852 | WARNING  | __main__:handle_order_fill:889 - üîÑ Stop loss filled at unit -1, placing BUY at unit 0
2025-09-19 12:21:31.852 | WARNING  | __main__:handle_order_fill:890 - üìä Remaining position after fill: 0.06496 BTC
2025-09-19 12:21:31.852 | WARNING  | __main__:_place_stop_buy_order:296 - üìä ATTEMPTING TO PLACE STOP BUY at unit 0
2025-09-19 12:21:31.852 | WARNING  | __main__:_place_stop_buy_order:300 - üéØ Placing stop-buy at UNIT 0 (entry price)
2025-09-19 12:21:31.853 | WARNING  | __main__:_place_stop_buy_order:301 - üéØ Unit 0 in position_map: True
2025-09-19 12:21:31.853 | INFO     | __main__:_place_stop_buy_order:331 - üìä Stop buy details: Unit 0, Price $115480.00, Size 0.021655 BTC, Value $2500.72
2025-09-19 12:21:32.099 | WARNING  | __main__:_place_stop_buy_order:338 - üéØ Price $115480.00 > Market $115445.00 - Using STOP BUY
2025-09-19 12:21:32.099 | INFO     | exchange.hyperliquid_sdk:place_stop_buy:598 - Placing STOP LIMIT BUY order: 0.021655 BTC triggers @ $115480.00, limit @ $115480.00
2025-09-19 12:21:33.618 | WARNING  | __main__:_place_stop_buy_order:352 - ‚úÖ STOP BUY SUCCESSFULLY PLACED at unit 0 (triggers @ $115480.00)
2025-09-19 12:21:33.619 | WARNING  | __main__:_place_stop_buy_order:353 - üìù ORDER ID TRACKING: Stop buy at unit 0 = 39342173054
2025-09-19 12:21:33.619 | WARNING  | __main__:handle_order_fill:901 - ‚úÖ Placed stop BUY at unit 0 for re-entry
2025-09-19 12:21:33.619 | INFO     | __main__:handle_order_fill:943 - üîß Validating window after fill at unit -1
2025-09-19 12:21:33.992 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: 0, Phase: retracement, Has Position: True
2025-09-19 12:21:33.993 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:21:33.993 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:21:33.993 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:21:33.993 | INFO     | __main__:handle_order_fill:947 - Lists after fill: Stop=[-4, -3, -2], Buy=[0]
2025-09-19 12:21:33.993 | INFO     | __main__:_handle_price_update:489 - üéØ UNIT EVENT DETECTED - Creating task to handle unit change
2025-09-19 12:21:33.993 | WARNING  | __main__:_handle_unit_change:496 - ‚ö° UNIT CROSSED! Unit -1 | Dir: down | Phase: Phase.RETRACEMENT
2025-09-19 12:21:33.994 | INFO     | __main__:_handle_unit_change:503 - üìç Current unit -1 price: $115455.0000
2025-09-19 12:21:34.250 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:21:34.250 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:21:34.250 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:21:34.250 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:21:34.250 | INFO     | __main__:_handle_unit_change:509 - Window state: Stops=[-4, -3, -2], Buys=[0]
2025-09-19 12:21:38.626 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:21:38.627 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:21:38.627 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:21:48.642 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:21:49.258 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:21:49.258 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:21:49.259 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:21:49.259 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:22:09.270 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:22:09.271 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:22:09.271 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:22:09.271 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:22:09.953 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:22:09.954 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:22:09.954 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:22:09.954 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:22:29.971 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:22:30.645 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:22:30.645 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:22:30.645 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:22:30.646 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:22:40.655 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:22:40.655 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:22:40.656 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:22:50.671 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:22:51.413 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:22:51.413 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:22:51.414 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:22:51.414 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:23:11.426 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:23:11.426 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:23:11.426 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:23:11.426 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:23:12.080 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:23:12.081 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:23:12.081 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:23:12.081 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:23:32.101 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:23:32.720 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:23:32.720 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:23:32.721 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:23:32.721 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:23:42.735 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:23:42.736 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:23:42.736 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:23:52.751 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:23:53.361 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -1, Phase: retracement, Has Position: True
2025-09-19 12:23:53.362 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:23:53.362 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:23:53.362 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:23:58.741 | INFO     | __main__:_handle_price_update:489 - üéØ UNIT EVENT DETECTED - Creating task to handle unit change
2025-09-19 12:23:58.741 | WARNING  | __main__:_handle_unit_change:496 - ‚ö° UNIT CROSSED! Unit -2 | Dir: down | Phase: Phase.RETRACEMENT
2025-09-19 12:23:58.742 | INFO     | __main__:_handle_unit_change:503 - üìç Current unit -2 price: $115430.0000
2025-09-19 12:23:59.236 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:23:59.236 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:23:59.237 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:23:59.237 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:23:59.237 | INFO     | __main__:_handle_unit_change:509 - Window state: Stops=[-4, -3, -2], Buys=[0]
2025-09-19 12:24:13.367 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:24:13.367 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:24:13.368 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:24:13.368 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:24:14.116 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:24:14.116 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:24:14.117 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:24:14.117 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:24:34.135 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:24:34.870 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:24:34.871 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:24:34.871 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:24:34.871 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:24:44.884 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:24:44.885 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:24:44.885 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:24:54.888 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:24:55.507 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:24:55.508 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:24:55.508 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:24:55.508 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:25:15.518 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:25:15.519 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:25:15.519 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:25:15.520 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:25:16.283 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:25:16.283 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:25:16.283 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:25:16.284 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:25:36.303 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:25:37.040 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:25:37.041 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:25:37.041 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:25:37.042 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:25:47.052 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:25:47.052 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:25:47.053 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:25:57.057 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:25:57.793 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:25:57.793 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:25:57.794 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:25:57.794 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:26:17.805 | INFO     | __main__:_log_order_summary:1018 - üìä ORDERS - Stop sells: 3, Stop buys: 1
2025-09-19 12:26:17.805 | INFO     | __main__:_log_order_summary:1020 -    Stop-losses: Unit -4: $115380.00, Unit -3: $115405.00, Unit -2: $115430.00
2025-09-19 12:26:17.805 | INFO     | __main__:_log_order_summary:1022 -    Stop buys: Unit 0: $115480.00
2025-09-19 12:26:17.806 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:26:18.428 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:26:18.429 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:26:18.429 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:26:18.429 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys
2025-09-19 12:26:38.457 | INFO     | __main__:run:987 - üîç Periodic window validation and cleanup
2025-09-19 12:26:39.082 | WARNING  | __main__:_validate_and_repair_window:594 - üîß VALIDATING WINDOW - Unit: -2, Phase: retracement, Has Position: True
2025-09-19 12:26:39.082 | WARNING  | __main__:_validate_and_repair_window:595 -    Current stops: [-4, -3, -2]
2025-09-19 12:26:39.082 | WARNING  | __main__:_validate_and_repair_window:596 -    Current buys: [0]
2025-09-19 12:26:39.083 | INFO     | __main__:_validate_and_repair_window:630 - ‚úÖ Window complete with 3 stops, 1 buys

## Screenshots

### Screenshot 1: Initial Orders Placed (12:23:21)
![Initial Orders](C:\Users\trini\Pictures\Screenshots\Screenshot 2025-09-19 122321.png)
- Shows 4 stop limit orders correctly placed initially
- Orders at $115,480, $115,430, $115,405, $115,380
- Each order size: 0.02166 BTC (~$2,501 each, 25% of position)
- All orders marked as "Close Long" with Reduce Only = No

### Screenshot 2: Position Status (12:24:16)
![Position Status](C:\Users\trini\Pictures\Screenshots\Screenshot 2025-09-19 122416.png)
- Position: 0.06496 BTC (reduced from 0.08662 after first stop triggered)
- Entry price: $115,480
- Mark price: $115,435
- PNL: +$1.23 (+0.07%)
- Shows ~75% of position remaining after 1 stop hit

### Screenshot 3: Chart View (12:24:48)
![Chart View](C:\Users\trini\Pictures\Screenshots\Screenshot 2025-09-19 122448.png)
- Shows 3 stop limit orders remaining after 1 was triggered
- Price at $115,435
- Orders visible at $115,430, $115,405, $115,380
- Missing the buy order that should be at $115,480 (current_unit + 1)

### Screenshot 4: Updated Position (12:25:13)
![Updated Position](C:\Users\trini\Pictures\Screenshots\Screenshot 2025-09-19 122513.png)
- Position still at 0.06496 BTC
- Entry price: $115,480
- Mark price: $115,468
- PNL: -$0.78 (-0.4%)
- Position value: $7,500.90

### Screenshot 5: Order History (12:25:52)
![Order History](C:\Users\trini\Pictures\Screenshots\Screenshot 2025-09-19 122552.png)
- Shows multiple stop limit orders in various states
- Several "Open" orders still active
- One order "Filled" and one "Triggered"
- Initial buy orders (Limit Long) partially filled
- Demonstrates the issue with order management

## Issues Identified from Screenshots

1. **Buy order missing** - After stop loss triggered at unit -1, should have buy order at unit 0 ($115,480) but it's not visible
2. **Order states inconsistent** - Some orders show "Triggered" but not filled, others "Open"
3. **Position correctly reduced** - From 0.08662 to 0.06496 BTC (75% remaining) which is correct
4. **Window not properly maintained** - Should have exactly 4 orders (3 stops + 1 buy) but buy is missing